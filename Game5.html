<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memory Card Game</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .game-container {
      display: grid;
      grid-template-columns: repeat(4, 100px);
      grid-gap: 10px;
      margin-left: 20px;
    }

    .history-container {
      width: 200px;
      padding: 20px;
      background-color: #ecf0f1;
      border-radius: 8px;
      margin-right: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    .history {
      margin-top: 20px;
    }

    .history ul {
      list-style-type: none;
      padding: 0;
    }

    .history li {
      background-color: #fff;
      padding: 10px;
      margin-bottom: 5px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .history li span {
      display: block;
      font-size: 14px;
      color: #34495e;
    }

    .card {
      width: 100px;
      height: 100px;
      background-color: #3498db;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      font-size: 24px;
      cursor: pointer;
      position: relative;
      border-radius: 8px;
      transition: transform 0.3s ease;
      transform-style: preserve-3d;
      transform: rotateY(0deg);
    }

    .card.flipped {
      transform: rotateY(180deg);
      background-color: #f39c12;
    }

    .card.matched {
      background-color: #2ecc71;
      cursor: default;
    }

    .card::after {
      content: '?';
      backface-visibility: hidden;
    }

    .card.flipped::after {
      content: attr(data-card);
    }

    .controls {
      margin-top: 20px;
      text-align: center;
    }

    .timer, .move-counter, .correct-guesses {
      font-size: 18px;
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #e74c3c;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #c0392b;
    }

    #ready-button {
      background-color: #27ae60;
    }

    #ready-button:hover {
      background-color: #2ecc71;
    }

    .game-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <div class="history-container">
      <h2>Game History</h2>
      <div class="history">
        <ul id="history-list">
          <!-- History results will appear here -->
        </ul>
      </div>
    </div>
    <div>
      <h1>Memory Card Game</h1>
      <div class="game-container">
        <!-- Cards will be generated by JavaScript -->
      </div>

      <div class="controls">
        <div class="timer">Time: <span id="timer">0</span> sec</div>
        <div class="move-counter">Moves: <span id="moves">0</span></div>
        <div class="correct-guesses">Correct Guesses: <span id="correct-guesses">0</span></div>
        <button id="ready-button">Ready</button>
        <button id="reset-button" style="display: none;">Play Again</button>
      </div>
    </div>
  </div>

  <script>
    const gameContainer = document.querySelector('.game-container');
    const timerDisplay = document.getElementById('timer');
    const movesDisplay = document.getElementById('moves');
    const correctGuessesDisplay = document.getElementById('correct-guesses');
    const readyButton = document.getElementById('ready-button');
    const resetButton = document.getElementById('reset-button');
    const historyList = document.getElementById('history-list');
    
    let flippedCards = [];
    let matchedCards = [];
    let emojis = [];
    let timer;
    let timeElapsed = 0;
    let moves = 0;
    let correctGuesses = 0;
    let gameStarted = false;
    let gameHistory = [];

    // Fetch emojis using an API
    async function fetchEmojis() {
      const response = await fetch('https://emoji-api.com/emojis?access_key=2325656d3ac9a9c287f5503977a4ddd7bba9e87b');
      const data = await response.json();
      emojis = data.slice(0, 8).map(emoji => emoji.character);  // Get first 8 emojis
      emojis = [...emojis, ...emojis];  // Duplicate for pairs
      shuffleCards();
    }

    // Shuffle function to randomize cards
    function shuffleCards() {
      const shuffledEmojis = [...emojis];
      shuffledEmojis.sort(() => Math.random() - 0.5); // Shuffle emojis
      generateCards(shuffledEmojis);
    }

    // Generate cards based on emojis
    function generateCards(emojis) {
      gameContainer.innerHTML = '';  // Clear previous cards
      emojis.forEach(emoji => {
        const card = document.createElement('div');
        card.classList.add('card');
        card.setAttribute('data-card', emoji);
        gameContainer.appendChild(card);

        card.addEventListener('click', () => flipCard(card));
      });
    }

    // Start timer
    function startTimer() {
      timer = setInterval(() => {
        timeElapsed++;
        timerDisplay.textContent = timeElapsed;
      }, 1000);
    }

    // Stop the timer
    function stopTimer() {
      clearInterval(timer);
    }

    // Reset the game
    function resetGame() {
      flippedCards = [];
      matchedCards = [];
      timeElapsed = 0;
      moves = 0;
      correctGuesses = 0;
      movesDisplay.textContent = moves;
      correctGuessesDisplay.textContent = correctGuesses;
      timerDisplay.textContent = timeElapsed;
      document.querySelectorAll('.card').forEach(card => {
        card.classList.remove('flipped', 'matched');
      });
      gameStarted = false; // Prevent starting the timer until user can guess
      fetchEmojis(); // Get new emojis and shuffle
      resetButton.style.display = 'none'; // Hide the reset button
      readyButton.style.display = 'inline'; // Show the "Ready" button
    }

    // Flip a card
    function flipCard(card) {
      if (!gameStarted) return; // Do not allow flipping cards until the reveal time is over

      if (flippedCards.length < 2 && !card.classList.contains('flipped') && !card.classList.contains('matched')) {
        card.classList.add('flipped');
        flippedCards.push(card);

        if (flippedCards.length === 2) {
          moves++;
          movesDisplay.textContent = moves;
          checkMatch();
        }
      }
    }

    // Check if two flipped cards match
    function checkMatch() {
      const [firstCard, secondCard] = flippedCards;

      if (firstCard.dataset.card === secondCard.dataset.card) {
        firstCard.classList.add('matched');
        secondCard.classList.add('matched');
        matchedCards.push(firstCard, secondCard);
        correctGuesses++;
        correctGuessesDisplay.textContent = correctGuesses;
        flippedCards = [];

        if (matchedCards.length === gameContainer.children.length) {
          stopTimer();
          alert(`You win! Time: ${timeElapsed}s, Moves: ${moves}, Correct Guesses: ${correctGuesses}`);
          saveGameHistory();
        }
      } else {
        setTimeout(() => {
          firstCard.classList.remove('flipped');
          secondCard.classList.remove('flipped');
          flippedCards = [];
        }, 1000);
      }
    }

    // Reveal all cards for 5 seconds when "Ready" button is clicked
    async function revealCards() {
      const allCards = document.querySelectorAll('.card');
      allCards.forEach(card => {
        card.classList.add('flipped');
        card.innerHTML = card.dataset.card;
      });

      setTimeout(() => {
        allCards.forEach(card => {
          card.classList.remove('flipped');
          card.innerHTML = ''; // Remove emoji content when cards are hidden
        });
        gameStarted = true; // Allow user to start guessing
        startTimer();
        readyButton.style.display = 'none'; // Hide the "Ready" button after it's clicked
        resetButton.style.display = 'inline'; // Show the reset button for a new game
      }, 5000); // Keep cards revealed for 5 seconds
    }

    // Save game history
    function saveGameHistory() {
      gameHistory.push({
        gameNumber: gameHistory.length + 1,
        moves: moves,
        time: timeElapsed,
        correctGuesses: correctGuesses
      });

      displayGameHistory();
    }

    // Display game history
    function displayGameHistory() {
      historyList.innerHTML = '';  // Clear previous history
      gameHistory.forEach(game => {
        const li = document.createElement('li');
        li.innerHTML = `Game ${game.gameNumber}: <span>Moves: ${game.moves}, Time: ${game.time}s, Correct Guesses: ${game.correctGuesses}</span>`;
        historyList.appendChild(li);
      });
    }

    // Add event listener to the reset button
    resetButton.addEventListener('click', resetGame);

    // Start the game
    resetGame();

    // Event listener for the "Ready" button
    readyButton.addEventListener('click', revealCards);
  </script>
</body>
</html>
